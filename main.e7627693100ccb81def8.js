(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var s=t.g.document;if(!e&&s&&(s.currentScript&&(e=s.currentScript.src),!e)){var i=s.getElementsByTagName("script");if(i.length)for(var a=i.length-1;a>-1&&!e;)e=i[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();class e{constructor(t,e,s=0,i=!1,a=!1){this.x=t,this.y=e,this.value=s,this.isOpen=i,this.isFlag=a}open(){this.isOpen=!0}}function s(t){return Math.floor(Math.random()*(t+1))}function i(t,e){const s=document.createElement(t);return s.classList.add(e),s}function a(t,e,s,i,a){return t[s]?.[e]!==t[a]?.[i]&&t[s-1]?.[e-1]!==t[a]?.[i]&&t[s-1]?.[e]!==t[a]?.[i]&&t[s-1]?.[e+1]!==t[a]?.[i]&&t[s]?.[e-1]!==t[a]?.[i]&&t[s]?.[e+1]!==t[a]?.[i]&&t[s+1]?.[e-1]!==t[a]?.[i]&&t[s+1]?.[e]!==t[a]?.[i]&&t[s+1]?.[e+1]!==t[a]?.[i]}function n(t,e,s){const i=t[s-1]?.[e-1],a=t[s-1]?.[e],n=t[s-1]?.[e+1],o=t[s]?.[e-1],l=t[s]?.[e+1],r=t[s+1]?.[e-1],h=t[s+1]?.[e],m=t[s+1]?.[e+1];return[i,a,n,o,l,r,h,m]}const o=t.p+"assets/803af7fe496d5f9253e6.mp3",l=t.p+"assets/6a992a75408676d4f5ab.mp3",r=t.p+"assets/75820d826030bb7db7bc.mp3",h=t.p+"assets/a912d9ce865d06a57d79.mp3",m=t.p+"assets/3478f5c320488b4c5c9a.mp3",c=t.p+"assets/28b096830198f3e1b195.mp3",d=t.p+"assets/7297f0c2df827567e681.mp3",g=t.p+"assets/08d358f357cad235dbf5.mp3",p=new Audio(o),u=new Audio(l),v=new Audio(r),b=new Audio(h);class x{matrix=JSON.parse(localStorage.getItem("matrix"))||[];totalBombs=+localStorage.getItem("matrixBombs")||10;isFirstClick=!localStorage.getItem("matrix");isLost=!1;isWin=!1;constructor(t,e,s,a=10){this.settings=t,this.container=e,this.length=s,this.totalBombs=a,this.boardElement=i("div","board"),this.boardElement.setAttribute("data-board-cells",this.length),this.container.setAttribute("data-board-cells",this.length),this.container.append(this.boardElement),localStorage.getItem("matrix")?(this.mapMatrix(),this.updateCells()):(this.addMatrix(s),this.addCells())}addMatrix(t){for(let s=0;s<t;s+=1){const i=[];for(let a=0;a<t;a+=1)i.push(new e(a,s));this.matrix.push(i)}}addCells(){this.matrix.forEach((t=>{t.forEach((t=>{const e=i("div","cell");e.textContent="",e.addEventListener("click",(()=>{this.clickHandler(t.x,t.y)})),e.addEventListener("contextmenu",(e=>{e.preventDefault(),this.addFlag(t.x,t.y)})),this.boardElement.append(e)}))})),this.checkCountFlags()}mapMatrix(){this.settings.startTimer(),this.matrix=this.matrix.map((t=>t.map((t=>new e(t.x,t.y,t.value,t.isOpen,t.isFlag)))))}updateCells(){this.boardElement.innerHTML="",this.matrix.forEach((t=>{t.forEach((t=>{const e=i("div","cell");t.isFlag&&(e.textContent="🚩"),t.isOpen&&(t.value?t.isFlag?e.textContent="🚩":!0===t.value?e.textContent="💥":t.value>0&&(e.textContent=t.value):e.textContent="",e.classList.add(`cell${t.value}`)),e.addEventListener("click",(()=>{this.clickHandler(t.x,t.y)})),e.addEventListener("contextmenu",(e=>{e.preventDefault(),this.addFlag(t.x,t.y)})),this.boardElement.append(e)}))})),this.checkEndGame()}checkEndGame(){const t=[];this.matrix.forEach(((e,s)=>{e.forEach(((e,i)=>{const a=this.matrix[s][i];!0===a.value&&a.isOpen&&(this.isLost=!0),!0!==a.value&&a.isOpen&&(t.push(a),t.length===this.length*this.length-this.totalBombs&&(this.isWin=!0))}))})),this.isLost&&(this.settings.sound&&u.play(),this.settings.stopTimer(),this.settings.openModal("defeat")),this.isWin&&(this.settings.sound&&b.play(),this.settings.stopTimer(),this.settings.openModal("win")),this.isLost||this.isWin?(localStorage.removeItem("matrix"),localStorage.removeItem("matrixBombs"),localStorage.removeItem("matrixSteps"),localStorage.removeItem("matrixFlags"),localStorage.removeItem("matrixTimer")):(localStorage.setItem("matrix",JSON.stringify(this.matrix)),localStorage.setItem("matrixBombs",this.totalBombs),localStorage.setItem("matrixSteps",this.settings.steps),localStorage.setItem("matrixFlags",this.settings.flags),localStorage.setItem("matrixTimer",this.settings.timer))}checkCountFlags(){const t=[];this.matrix.forEach(((e,s)=>{e.forEach(((e,i)=>{const a=this.matrix[s][i];a.isFlag&&t.push(a)}))})),this.settings.flags=t.length,this.settings.infoBombs.textContent="💣"+(this.totalBombs-this.settings.flags),this.settings.infoFlags.textContent=`🚩${this.settings.flags}`}addBombs(t,e){let i=this.totalBombs;for(;i;){const n=s(this.length-1),o=s(this.length-1);!0!==this.matrix[o][n]?.value&&(this.totalBombs<92&&10===this.length||this.length>10?a(this.matrix,t,e,n,o)&&(this.matrix[o][n].value=!0,i-=1):this.matrix[e]?.[t]!==this.matrix[o]?.[n]&&(this.matrix[o][n].value=!0,i-=1))}this.addCellsValue()}clickEmptyCell(t,e){n(this.matrix,t,e).forEach((t=>{t&&!t.isOpen&&!0!==t.value&&(0===t.value&&(t.open(),this.clickEmptyCell(t.x,t.y)),t.value>0&&t.open())}))}clickNumberCells(t,e){const s=n(this.matrix,t,e),i=s.filter((t=>t?.isFlag));this.matrix[e][t].value===i.length&&s.forEach((t=>{t&&!0!==t.isFlag&&(t.open(),0===t.value&&(t.open(),this.clickEmptyCell(t.x,t.y)))}))}addFlag(t,e){const s=this.matrix[e][t];s.isOpen||(s.isFlag=!s.isFlag),this.settings.sound&&v.play(),this.settings.steps+=1,this.settings.infoSteps.textContent=`🐾${this.settings.steps}`,this.checkCountFlags(),this.updateCells()}openBombs(){this.matrix.forEach(((t,e)=>{t.forEach(((t,s)=>{!0===this.matrix[e][s].value&&this.matrix[e][s].open()}))}))}addCellsValue(){this.matrix.forEach(((t,e)=>{t.forEach(((t,s)=>{const i=this.matrix[e-1]?.[s-1]?.value,a=this.matrix[e-1]?.[s]?.value,n=this.matrix[e-1]?.[s+1]?.value,o=this.matrix[e]?.[s-1]?.value,l=this.matrix[e]?.[s+1]?.value,r=this.matrix[e+1]?.[s-1]?.value,h=this.matrix[e+1]?.[s]?.value,m=this.matrix[e+1]?.[s+1]?.value,c=[i,a,n,o,l,r,h,m].filter((t=>!0===t)).length;!0!==this.matrix[e][s].value&&(this.matrix[e][s].value=c)}))}))}clickHandler(t,e){const s=this.matrix[e][t];if(this.settings.setFlags)this.addFlag(t,e);else if(this.isFirstClick&&(this.addBombs(t,e),this.isFirstClick=!1,this.settings.startTimer(),this.settings.sound&&p.play(),this.settings.sound&&this.settings.playMainMenu.pause(),this.settings.steps+=1,this.settings.infoSteps.textContent=`🐾${this.settings.steps}`),s.isOpen||s.isFlag||(this.settings.sound&&p.play(),s.open(),0===s.value&&(this.clickEmptyCell(t,e),this.updateCells()),!0===s.value&&(this.openBombs(t,e),this.updateCells(),this.settings.sound&&u.play())),s.isOpen&&s.value>0){if(!0===s.value)return;this.clickNumberCells(t,e),this.updateCells(),this.settings.sound&&p.play(),this.isLost||this.isWin||(this.settings.steps+=1,this.settings.infoSteps.textContent=`🐾${this.settings.steps}`)}}}const f=new Audio(c),S=new Audio(d),C=new Audio(m);class _{connainer=null;lengthBoard=+localStorage.getItem("length")||10;bombs=+localStorage.getItem("bombs")||10;sound=!localStorage.getItem("sound")||JSON.parse(localStorage.getItem("sound"));darkTheme=JSON.parse(localStorage.getItem("theme"))||!1;steps=+localStorage.getItem("matrixSteps")||0;flags=+localStorage.getItem("matrixFlags")||0;setFlags=!1;timer=+localStorage.getItem("matrixTimer")||0;timerWorks=null;constructor(t){this.container=t,localStorage.getItem("sound"),this.playMainMenu=new Audio(g),this.playMainMenu.loop=!0,this.minesweeperElement=i("div","minesweeper"),this.container.append(this.minesweeperElement),this.createSettings()}createSettings(){this.minesweeperElement.innerHTML="";const t=i("h2","header");t.textContent="Minesweeper";const e=i("div","description");e.textContent="To set a flag, click right mouse button";const s=i("div","settings"),a=i("div","settings__main"),n=i("select","settings__level"),o=i("option","settings__option");o.textContent="Easy",o.setAttribute("value","10");const l=i("option","settings__option");l.textContent="Medium",l.setAttribute("value","15");const r=i("option","settings__option");r.textContent="Hard",r.setAttribute("value","25"),10===this.lengthBoard?o.setAttribute("selected","true"):15===this.lengthBoard?l.setAttribute("selected","true"):25===this.lengthBoard&&r.setAttribute("selected","true"),n.addEventListener("change",(t=>{this.sound&&f.play(),this.lengthBoard=+t.target.value,10==+t.target.value?(this.bombs=10,this.settBombsCount.value=10):15==+t.target.value?(this.bombs=40,this.settBombsCount.value=40):25==+t.target.value&&(this.bombs=80,this.settBombsCount.value=80),localStorage.setItem("length",+t.target.value),localStorage.setItem("bombs",this.bombs)})),n.append(o,l,r);const h=i("div","settings__bombs-wrap");this.settBombsCount=i("input","settings__bombs"),this.settBombsCount.setAttribute("type","number"),this.settBombsCount.setAttribute("min","10"),this.settBombsCount.setAttribute("max","99"),this.settBombsCount.setAttribute("value",this.bombs),this.settBombsCount.addEventListener("change",(t=>{this.sound&&f.play(),+t.target.value>9&&+t.target.value<100&&(this.bombs=+t.target.value,localStorage.setItem("bombs",+t.target.value))}));const m=i("div","settings__bombs-img");m.textContent="💣",h.append(this.settBombsCount,m);const c=i("div","settings__addit"),d=i("div","settings__records");d.textContent="📊",d.addEventListener("click",(()=>this.openModal("records")));const g=i("div","settings__sound");this.sound||g.classList.add("active"),g.textContent="🎵",g.addEventListener("click",(t=>this.controlSound(t)));const p=i("div","settings__theme");this.darkTheme&&(p.classList.add("active"),this.container.classList.add("dark")),p.textContent="☯",p.addEventListener("click",(t=>this.changeTheme(t)));const u=i("div","info"),v=i("div","info__block-left");this.infoBombs=i("div","info__bombs"),this.infoBombs.textContent="💣"+((+localStorage.getItem("matrixBombs")||this.bombs)-this.flags),this.infoFlags=i("div","info__flags"),this.infoFlags.textContent=`🚩${this.flags}`,this.infoFlags.addEventListener("click",(t=>{t.target.classList.contains("active")?(this.setFlags=!1,t.target.classList.remove("active")):(this.setFlags=!0,t.target.classList.add("active"))})),v.append(this.infoBombs,this.infoFlags);const b=i("div","info__button");b.textContent="New game",b.addEventListener("click",(()=>this.startNewGame()));const S=i("div","info__block-right");this.infoSteps=i("div","info__steps"),this.infoSteps.textContent=`🐾${this.steps}`,this.infoTime=i("div","info__time"),this.infoTime.textContent="000",S.append(this.infoSteps,this.infoTime),a.append(n,h),c.append(d,g,p),s.append(a,c),u.append(v,b,S),this.minesweeperElement.append(t,e,s,u),this.board=new x(this,this.container,JSON.parse(localStorage.getItem("matrix"))?.length||this.lengthBoard,+localStorage.getItem("matrixBombs")||this.bombs)}openModal(t){const e=i("div","overlay");e.addEventListener("click",(s=>{s.target.classList.contains("overlay")&&("records"===t?e.remove():this.startNewGame())}));const s=i("div","modal"),a=i("div","modal__btn-close");a.textContent="×",a.addEventListener("click",(()=>{"records"===t?e.remove():this.startNewGame()}));const n=i("div","modal__content");if("win"===t)this.sound&&S.play(),n.classList.add("modal-info"),n.textContent=`Hooray! You found all mines in ${this.timer} seconds and ${this.steps} moves!`;else if("defeat"===t)this.sound&&C.play(),n.classList.add("modal-info"),n.textContent="Game over. Try again";else if("records"===t){this.sound&&f.play();const t=i("h2","modal__records-header");if(t.textContent="Last results",n.append(t),localStorage.getItem("records")){const t=i("ol","modal__records-list");JSON.parse(localStorage.getItem("records")).sort(((t,e)=>t.time-e.time)).forEach((e=>{const s=e.date.split("T")[0],a=e.date.split("T")[1].split(".")[0];if(e.win){let n="";10===e.level&&(n="Easy"),15===e.level&&(n="Medium"),25===e.level&&(n="Hard");const o=i("li","modal__records-item");o.textContent=`${e.time} seconds - ${e.steps} steps - ${n} level - ${a} ${s}`,t.append(o)}else{const e=i("li","modal__records-item");e.textContent=`The game is lost - ${a} ${s}`,t.append(e)}})),n.append(t)}else{const t=i("div","modal__records-empty");t.textContent="Results list is empty...",n.append(t)}}const o=i("div","modal__btn-start");if(o.textContent="Start new game",o.addEventListener("click",(()=>this.startNewGame())),s.append(a,n,o),e.append(s),this.minesweeperElement.append(e),"records"!==t){let t=JSON.parse(localStorage.getItem("records"))||[];10===t.length&&(t=t.slice(1)),t.push({time:this.board.isWin?this.timer:999,steps:this.steps,level:this.lengthBoard,win:this.board.isWin,date:new Date}),localStorage.setItem("records",JSON.stringify(t))}}changeTheme(t){this.sound&&f.play(),t.target.classList.contains("active")?(this.darkTheme=!1,localStorage.setItem("theme",!1),t.target.classList.remove("active"),this.container.classList.remove("dark")):(this.darkTheme=!0,localStorage.setItem("theme",!0),t.target.classList.add("active"),this.container.classList.add("dark"))}controlSound(t){f.play(),t.target.classList.contains("active")?(t.target.classList.remove("active"),this.sound=!0,localStorage.setItem("sound",!0)):(t.target.classList.add("active"),this.sound=!1,this.playMainMenu.pause(),localStorage.setItem("sound",!1))}startNewGame(){this.sound&&this.playMainMenu.play(),this.sound&&f.play(),S.pause(),this.board.boardElement.remove(),this.board=null,this.timer=0,this.steps=0,this.stopTimer(this.timerWorks),localStorage.removeItem("matrix"),localStorage.removeItem("matrixBombs"),localStorage.removeItem("matrixSteps"),localStorage.removeItem("matrixFlags"),localStorage.removeItem("matrixTimer"),this.createSettings()}startTimer(){clearInterval(),this.timerWorks=setInterval((()=>{this.timer+=1,this.timer<10?this.infoTime.textContent=`00${this.timer}`:this.timer<100?this.infoTime.textContent=`0${this.timer}`:this.infoTime.textContent=this.timer,this.timer>600&&(this.board.isLost=!0,this.stopTimer(),this.openModal("defeat"))}),1e3)}stopTimer(){clearInterval(this.timerWorks)}}!function(){const t=i("div","main");document.body.append(t),new _(t)}()})();